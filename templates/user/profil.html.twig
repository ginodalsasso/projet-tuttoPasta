{% extends 'base.html.twig' %}

{% block title %}Mon profil{% endblock %}

{% block page_title %}Profil{% endblock %}

{% block body %}
    {{ parent() }}{# Inclus le "page_title" ainsi que les propriétés du header #}
    <main class="wrapper">
        <div id="user_content">
            <p><b>Pseudo:</b> {{user.username|capitalize}} </p>
            <p><b>Email:</b> {{user.email}} </p>
            <p><b>Date de création du compte:</b> {{user.accountDate|date('d/m/Y')}}</p>
            {% if appointments %}                
                <p><b>Mes rendez-vous: </b></p>
                {% for appointment in appointments %}
                    <div class="appointment_user" id="appointment-{{ appointment.id }}">
                        <p>{{ appointment.startDate|date('d/m/Y H:i') }} 
                        {{ appointment.endDate|date('à H:i') }}</p>
                        <a href="#" class="cancel_appointment" data-id="{{ appointment.id }}"><img src="{{ asset('/img/annuler.png')}}" height="18" alt="icône d'annulation"</a>
                    </div>
                {% endfor %}
            {% endif %}
        </div>
        <div id="user_action_buttons">
            <a class="show_modal_edit_data full_button_black">Modifier mes informations</a>
            <a class="show_modal_edit_password full_button_black">Modifier mon mot de passe</a>
            <a class="full_button_red" id="delete_account_link" href="{{ path('app_delete_account') }}">Suprimer mon comtpe</a>
        </div>

        
        {# Modale d'édition des information utilisateur #}
        <dialog class="modal_edit_data">
            {{ form_start(form, {'action': path('app_profil_update_info')}) }}
                {{ form_row(form.username) }}
                <div class="error_msg" id="pseudo_error"></div>

                {{ form_row(form.email) }}
                <div class="error_msg" id="email_error"></div>

                <div class="center_button">
                    <button class="full_button_black" id="save_edit_data" type="submit">Valider les informations</button>
                </div>
            {{ form_end(form) }}
            <button class="closeModal">X</button>
        </dialog>

        {# Modal d'édition de mot de passe #}
        <dialog class="modal_edit_password">
            {{ form_start(passwordForm, {'action': path('app_profil_update_password')}) }}
                {{ form_widget(passwordForm) }}
                <div class="error_msg" id="password_error"></div>

                <div class="center_button">
                    <button class="full_button_black" id="save_edit_password" type="submit">Changer le mot de passe</button>
                </div>
            {{ form_end(form) }}
            <button class="closeModal">X</button>
        </dialog>
    </main>
{% endblock %}

{% block javascripts %}
    <script src="{{ asset('/js/profil.js')}}"></script>
    <script src="{{ asset('/js/appointment.js')}}"></script>
{% endblock %}